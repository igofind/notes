# 表分区常用操作

数据库版本为 MySQL 5.7

查看表分区语句

```mysql
-- 可以查询该表的建表语句
SHOW CREATE TABLE test.employees;
```

查看表分区信息

```mysql
SELECT PARTITION_NAME,TABLE_ROWS FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_NAME = 'r1';
+----------------+------------+
| PARTITION_NAME | TABLE_ROWS |
+----------------+------------+
| p0             |          0 |
| p1             |          3 |
+----------------+------------+
```

给没有分区的表添加分区

```mysql
ALTER TABLE employees PARTITION BY RANGE COLUMNS (lname)  (
    PARTITION p0 VALUES LESS THAN ('g'),
    PARTITION p1 VALUES LESS THAN ('m'),
    PARTITION p2 VALUES LESS THAN ('t'),
    PARTITION p3 VALUES LESS THAN (MAXVALUE)
);
```

删除分区

```mysql
-- 删除单个分区（RANGE分区），删除后再插入数据时，以前位于p2的数据会插入下个分区
ALTER TABLE tr DROP PARTITION p2;
-- 删除单个分区（LIST分区），删除后再插入数据时，以前位于p2的数据将无法插入
ALTER TABLE tr DROP PARTITION p2;
```

追加分区

```mysql
-- 添加单个分区（RANGE分区），新加分区的界限值要比已有的大，否则就会报错
-- 1.追加分区，不能插入分区 -> 符合严格递增的规则
ALTER TABLE tr ADD PARTITION (PARTITION p2 VALUES LESS THAN (2010));
-- 2.拆分已有分区，将某个分区拆成复合分区（建表语句中会正常显示RANGE分区而不是复合分区）
--   拆分的分区，数据不会丢失
ALTER TABLE tr reorganize PARTITION p3 INTO (
	PARTITION n1 VALUES less than (2000),
	PARTITION n2 VALUES less than (2005)
  -- 拆分时还可以重命名分区
  -- PARTITION p2 VALUES less than (2000),
  -- PARTITION p3 VALUES less than (2005)
);

-- 添加单个分区（LIST分区）
ALTER TABLE TR ADD PARTITION (PARTITION p2 VALUES IN (2009, 2010, 2011));
```



清空数据

```mysql
-- 可以删除单个分区
-- 清空全部数据
TRUNCATE TABLE tr;
```

